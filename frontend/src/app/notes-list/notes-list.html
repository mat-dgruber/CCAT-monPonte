<div class="p-4">
  <!-- Barra de Ferramentas: Busca e Botão de Criar -->
  <div class="mb-4 flex flex-wrap items-center justify-between gap-4"> 
    <div class="relative flex-grow">
      <input
        type="text"
        aria-label="Buscar notas por título ou conteúdo" placeholder="Buscar notas por título ou conteúdo..."
        [value]="searchTerm()"
        (input)="onSearch($event)"
        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-dark-primary dark:border-dark-border dark:text-white transition-colors duration-300"
      />
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <lucide-icon name="search" size="18" class="text-gray-400 dark:text-dark-text-secondary"></lucide-icon>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <button (click)="openCreateNoteModal()" aria-label="Criar nova nota" class="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 whitespace-nowrap">
        <lucide-icon name="plus" size="16"></lucide-icon>
        <span>Criar Nota</span>
      </button>
    </div>
  </div>

  @if (isLoading()) {
    <p class="text-center text-gray-500 dark:text-dark-text-secondary">Carregando notas...</p>
  } @else if (error()) {
    <p class="text-red-500" role="alert">{{ error() }}</p>
  } @else if (filteredNotes().length === 0) {    
    <div class="text-center py-10 px-4 bg-gray-50 dark:bg-dark-accent/20 rounded-lg transition-colors duration-300" role="status">
      <lucide-icon name="file-text" size="48" class="mx-auto text-gray-400 dark:text-dark-text-secondary"></lucide-icon>
      <h3 class="mt-2 text-lg font-medium text-gray-800 dark:text-white">{{ searchTerm() ? 'Nenhuma nota encontrada para "' + searchTerm() + '"' : 'Nenhuma nota encontrada' }}</h3>
      <p class="mt-1 text-sm text-gray-500 dark:text-dark-text-secondary">{{ !searchTerm() ? 'Crie sua primeira nota neste caderno!' : 'Tente uma busca diferente.' }}</p>
    </div>
  } @else if (filteredNotes().length > 0) {
    <div class="space-y-2" @listAnimation role="region" aria-live="polite"> 
      @for (note of filteredNotes(); track note.id) {
        <div role="article" tabindex="0" class="bg-white dark:bg-dark-primary rounded-lg shadow-md p-3 flex items-center justify-between group cursor-pointer" (click)="openNoteEditor(note)">
          <div class="flex-grow overflow-hidden min-w-0">
            <h3 class="font-bold text-md truncate" [innerHTML]="note.title | highlight: searchTerm()"></h3>
            <div class="text-gray-500 dark:text-dark-text-secondary text-sm line-clamp-1" [innerHTML]="note.content | highlight: searchTerm()"></div>
            <div class="mt-2 flex flex-wrap gap-1">
              @for (tag of note.tags; track tag) {
                <span class="bg-gray-200 dark:bg-dark-accent text-gray-700 dark:text-dark-text-secondary text-xs font-medium px-2 py-0.5 rounded-full">{{ tag }}</span>
              }
            </div>
          </div> 
          <div class="flex items-center gap-2 ml-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
            <button (click)="deleteNote(note.id, note.title); $event.stopPropagation()" aria-label="Deletar nota" title="Deletar Nota" class="p-1 rounded-full text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50">
              <lucide-icon name="trash-2" size="18"></lucide-icon>
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>


<!-- Modal de Confirmação de Exclusão -->
<app-confirmation-modal role="dialog" aria-modal="true" aria-labelledby="delete-confirmation-modal-title"
  [isVisible]="showDeleteConfirmationModal()" 
  [message]="'Tem certeza que deseja deletar a nota &quot;' + noteToDelete()?.title + '&quot;? Esta ação não pode ser desfeita.'"
  (confirm)="confirmDeleteNote()"
  (cancel)="cancelDeleteNote()"
></app-confirmation-modal>