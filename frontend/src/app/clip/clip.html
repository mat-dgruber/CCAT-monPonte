<div class="flex-grow bg-gray-100 dark:bg-gray-900 p-4 rounded-lg md:p-8 transition-colors duration-300">

  <div class="max-w-4xl mx-auto bg-white dark:bg-gray-800 rounded-3xl shadow-2xl overflow-hidden transition-colors duration-300">

    <div class="p-4 sm:p-6">
      <textarea
        [ngModel]="clipService.copyText()"
        (ngModelChange)="onTextChange($event)"
        aria-label="Conteúdo do Clip"
        class="w-full border rounded-lg notebook-textarea leading-6 pl-14 pt-2 bg-yellow-50 border-gray-300 focus:border-sky-600 focus:ring-2 focus:ring-sky-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:placeholder-gray-400 dark:focus:border-sky-500 transition-colors duration-300"
        placeholder="Cole seu texto aqui..."
        rows="15"
        [style.fontFamily]="clipService.selectedFont()"
        [style.fontSize]="clipService.selectedFontSize()">
      </textarea>
    </div>

    <div class="flex flex-wrap items-center justify-between gap-4 p-4 bg-gray-50 dark:bg-gray-800/50 border-t border-gray-200 dark:border-gray-700 transition-colors duration-300">
      
      @if (clipService.showAdvancedClipOptions()) {
        <div class="text-sm text-gray-500 dark:text-gray-400 font-mono">
          <span>Caracteres: {{ clipService.characterCount() }}</span>
          <span class="mx-2">|</span>
          <span>Palavras: {{ clipService.wordCount() }}</span>
        </div>
      }

      <div class="flex items-center gap-4">
        <button 
          (click)="clearText()" aria-label="Limpar conteúdo do Clip"
          class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium transition-colors duration-200 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500">
          Limpar
        </button>
        <button 
          (click)="onCopy()" aria-label="Copiar todo o conteúdo do Clip"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors duration-200 shadow-sm hover:shadow-md">
          Copiar tudo
        </button>
      </div>

      @if (clipService.showAdvancedClipOptions()) {
        <div class="flex items-center gap-2">
          <label for="font-select" class="text-sm font-medium text-gray-600 dark:text-gray-300">Fonte:</label>
          <select id="font-select" 
                  class="px-2 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                  [value]="clipService.selectedFont()"
                  (change)="onFontChange($event)">
            @for (font of availableFonts; track font.family) {
              <option [value]="font.family">{{ font.name }}</option>
            }
          </select>
        </div>
      }

      @if (clipService.showAdvancedClipOptions()) {
        <div class="flex items-center gap-2">
          <label for="font-size-select" class="text-sm font-medium text-gray-600 dark:text-gray-300">Tamanho:</label>
          <select id="font-size-select"
                  class="px-2 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                  [value]="clipService.selectedFontSize()"
                  (change)="onFontSizeChange($event)">
            @for (size of availableFontSizes; track size.size) {
              <option [value]="size.size">{{ size.name }}</option>
            }
          </select>
        </div>
      }

      <button (click)="toggleAdvancedClipOptions()"
              class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium transition-colors duration-200 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500">
        {{ clipService.showAdvancedClipOptions() ? 'Ocultar Opções' : 'Mostrar Opções' }}
      </button>

      <button 
        (click)="openConvertToNoteModal()" aria-label="Converter Clip em Nota"
        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium transition-colors duration-200 shadow-sm hover:shadow-md">
        Converter em Nota
      </button>
    </div>
  </div>
</div>
@if (isModalVisible) {
  <app-modal
    title="Converter em Nota"
    confirmText="Confirmar"
    cancelText="Cancelar"
    (onConfirm)="confirmConvertToNote()"
    (onCancel)="cancelConvertToNote()"
  >
    <div class="mb-4">
      <label id="noteTitleLabel" for="noteTitle" class="block text-gray-700 dark:text-gray-300 font-bold mb-2">Título da Nota:</label>
      <input type="text" id="noteTitle" [(ngModel)]="newNoteTitle" aria-labelledby="noteTitleLabel" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200">
    </div>

    <div class="mb-6">
      @if (!isCreatingNewNotebook) {
        <label id="notebookSelectLabel" for="notebookSelect" class="block text-gray-700 dark:text-gray-300 font-bold mb-2">Salvar no Caderno:</label>
        <select id="notebookSelect" [(ngModel)]="selectedNotebookIdForNote" aria-labelledby="notebookSelectLabel" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200">
          <option [ngValue]="null" disabled>Selecione um caderno</option>
          @for (notebook of notebooks; track notebook.id) {
            <option [value]="notebook.id">{{ notebook.name }}</option>
          }
        </select>
        <button (click)="isCreatingNewNotebook = true" aria-label="Criar novo caderno" class="mt-2 text-blue-600 hover:underline dark:text-blue-400">+ Criar novo caderno</button>
      } @else {
        <label id="newNotebookNameLabel" for="newNotebookName" class="block text-gray-700 dark:text-gray-300 font-bold mb-2">Nome do Novo Caderno:</label>
        <input type="text" id="newNotebookName" [(ngModel)]="newNotebookName" aria-labelledby="newNotebookNameLabel" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200">
        <div class="mt-2 flex gap-2">
          <button (click)="createNewNotebookFromModal()" [disabled]="!newNotebookName.trim()" aria-label="Salvar novo caderno" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Salvar Caderno</button>
          <button (click)="isCreatingNewNotebook = false; newNotebookName = ''" aria-label="Cancelar criação de novo caderno" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500">Cancelar</button>
        </div>
      }
    </div>

    <div class="mb-4">
      <input type="checkbox" id="deleteClip" [(ngModel)]="deleteClipAfterConversion" aria-describedby="deleteClipDescription">
      <label id="deleteClipDescription" for="deleteClip" class="ml-2 text-gray-700 dark:text-gray-300">Limpar Clip após conversão</label>
    </div>

    @if (isCreatingNote) {
      <p class="mt-2 dark:text-gray-300">Salvando...</p>
    }
  </app-modal>
}
