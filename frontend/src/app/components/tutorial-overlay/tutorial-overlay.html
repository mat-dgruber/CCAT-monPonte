@if (tutorialService.isActive()) {
    <!-- Backdrop -->
    <div class="fixed inset-0 z-[9998] bg-black bg-opacity-50 transition-opacity" aria-hidden="true"></div>

    <!-- Popover Card -->
    <!-- Positioned dynamically via floating-ui in TS -->

    <div
      id="tutorial-popover"
      class="fixed z-[9999] bg-white dark:bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm w-full transition-opacity duration-300"
      [class.fixed-center]="isCenterPosition()"
      >
      <!-- Arrow Element -->
      <div id="tutorial-arrow" class="absolute w-4 h-4 bg-white dark:bg-gray-800 rotate-45"></div>

      <div class="flex justify-between items-start mb-4 relative z-10">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white">{{ tutorialService.currentStep().title }}</h3>
        <!-- Close button -->
        <button (click)="tutorialService.stop()" aria-label="Fechar tutorial" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
          <lucide-icon name="x" size="20"></lucide-icon>
        </button>
      </div>

      <p class="text-gray-600 dark:text-gray-300 mb-6 leading-relaxed relative z-10">
        {{ tutorialService.currentStep().content }}
      </p>

      <div class="flex justify-between items-center">
        <!-- Dots indicators -->
        <div class="flex gap-1">
            @for (step of tutorialService.steps; track $index) {
                <div class="w-2 h-2 rounded-full transition-colors"
                     [class.bg-accent]="$index === tutorialService.currentStepIndex()"
                     [class.bg-gray-300]="$index !== tutorialService.currentStepIndex()"
                     [class.dark:bg-gray-600]="$index !== tutorialService.currentStepIndex()">
                </div>
            }
        </div>

        <div class="flex gap-2">
          @if (!tutorialService.isFirstStep()) {
            <button (click)="tutorialService.previous()" class="px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
              Anterior
            </button>
          }

          <button (click)="handleNext()" class="px-4 py-2 text-sm font-medium bg-accent text-white rounded-lg hover:brightness-110 transition-all shadow-md">
            {{ tutorialService.isLastStep() ? 'Concluir' : 'Pr√≥ximo' }}
          </button>
        </div>
      </div>
    </div>
  }

