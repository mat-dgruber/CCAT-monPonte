<div class="flex flex-col h-full bg-white dark:bg-dark-panel-middle transition-colors duration-300">
  <!-- Header with Search and Create Button -->
  <div class="flex-shrink-0 p-3 border-b border-gray-200 dark:border-dark-border transition-colors duration-300">
    <div class="flex items-center gap-2">
      @if (showBackButton) {
        <button (click)="back.emit()" class="p-2 text-gray-500 rounded-full hover:bg-gray-200 dark:text-dark-text-secondary dark:hover:bg-dark-accent">
          <lucide-icon name="arrow-left" size="20"></lucide-icon>
        </button>
      }
      <div class="relative flex-grow">
        <lucide-icon name="search" size="16" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-dark-text-secondary"></lucide-icon>
        <input
          type="text"
          placeholder="Buscar notas..."
          [value]="searchTerm()" 
          (input)="onSearch($event)" 
          class="w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-dark-primary dark:border-dark-border dark:text-white dark:focus:ring-indigo-600 transition-colors duration-300"
        />
      </div>
      <button (click)="openCreateNoteModal()" class="flex-shrink-0 p-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium whitespace-nowrap">
        <lucide-icon name="plus" size="18"></lucide-icon>
        <span class="ml-1 hidden sm:inline">Nova Nota</span>
      </button>
    </div>
  </div>

  <!-- Notes List Area -->
  <div class="flex-grow overflow-y-auto p-2">
    @if (isLoading()) {
      <div class="space-y-2">
        @for (_ of [1, 2, 3, 4, 5, 6]; track $index) {
          <div class="h-20 bg-gray-200 rounded-lg dark:bg-dark-accent animate-pulse"></div>
        }
      </div>
    } @else if (error()) {
      <div class="p-4 text-center text-red-500 dark:text-red-400 transition-colors duration-300">
        <p>{{ error() }}</p>
      </div>
    } @else if (filteredNotes().length === 0) {
      <div class="text-center py-10 px-4">
        <lucide-icon name="file-text" size="48" class="mx-auto text-gray-400 dark:text-dark-text-secondary"></lucide-icon>
        <h3 class="mt-2 text-lg font-medium text-gray-800 dark:text-white">Nenhuma nota encontrada</h3>
        <p class="mt-1 text-sm text-gray-500 dark:text-dark-text-secondary">Crie uma nova nota para começar.</p>
      </div>
    } @else {
      <div class="space-y-2" @listAnimation>
        @for (note of filteredNotes(); track note.id) {
          <div 
            class="bg-white dark:bg-dark-primary/50 rounded-lg p-3 cursor-pointer transition-all duration-150 ease-in-out note-drag-item border-l-4 transition-colors duration-300"
            [class.border-indigo-500]="note.id === activeNoteId()"
            [class.bg-indigo-50]="note.id === activeNoteId()"
            [class.dark:bg-dark-accent/50]="note.id === activeNoteId()"
            [class.border-transparent]="note.id !== activeNoteId()"
            [class.hover:bg-gray-100]="note.id !== activeNoteId()"
            [class.dark:hover:bg-dark-accent]="note.id !== activeNoteId()"
            (click)="selectNote(note.id)"> 
            <h3 class="font-semibold text-md truncate text-gray-800 dark:text-white" [innerHTML]="note.title | highlight: searchTerm()"></h3>
            <p class="text-gray-600 dark:text-dark-text-secondary text-sm line-clamp-2 mt-1" [innerHTML]="note.content | highlight: searchTerm()"></p>
          </div>
        }
      </div>
    }
  </div>
</div>

<!-- Modal de Criar/Editar Nota -->
@if (isNoteModalVisible()) {
  <app-modal
    [title]="isEditing() ? 'Editar Nota' : 'Criar Nova Nota'"
    confirmText="Salvar"
    (onConfirm)="saveNote(currentNote())"
    (onCancel)="closeNoteModal()"
  >
    <div class="space-y-4">
      <input type="text" [(ngModel)]="currentNote().title" class="w-full p-2 border border-gray-300 rounded-lg dark:bg-dark-primary dark:border-dark-border dark:text-white transition-colors duration-300" placeholder="Título da nota">
      <textarea [(ngModel)]="currentNote().content" class="w-full p-2 border rounded-lg dark:bg-dark-primary dark:border-dark-border dark:text-white transition-colors duration-300" placeholder="Conteúdo da nota" rows="5"></textarea>
    </div>
  </app-modal>
}
